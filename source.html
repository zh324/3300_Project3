<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - geometry - catmull spline editor</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link href="https://fonts.googleapis.com/css?family=Raleway:300" rel="stylesheet">
		<style>
			html, body {
      color: #333;
      font-family: 'Raleway', 'Open Sans', 'Helvetica Neue', Helvetica, sans-serif;
    }
    a {
      text-decoration: none;
    }
    .card {
      padding: 28px 0;
      position: absolute;
      left: 30px;
      z-index: 1;
      width: 310px;
      border-radius: 3px;
      background: #fff;
      border: 1px solid #bbb;
    }
    .title {
      top: 30px;
      width: 310px;
      opacity: 1;
      border: 1px solid #bbb;
      font-size: 17px;
      background: #fff;
      z-index: 5;
      transition: width 500ms cubic-bezier(0.215, 0.610, 0.355, 1),
                  font-size 500ms cubic-bezier(0.215, 0.610, 0.355, 1),
                  border 500ms linear 400ms,
                  background 500ms linear 300ms;
    }
    .title h1 {
      opacity: 1;
      transition: opacity 600ms linear;
    }
    .title h1.hidden {
      opacity: 0;
    }
    .title h1 {
      font-weight: 200;
      margin: 0;
      padding: 0 35px;
      letter-spacing: -1px;
      line-height: 100%;
    }
    .instructions {
      margin: 17px 0;
      padding: 0 35px;
      font-size: 15px;
      line-height: 1.2rem;
      color: #999;
      opacity: 1;
      transition: opacity 500ms linear 400ms;
    }
    .links {
      padding: 0 35px;
      margin: 15px 0 0;
      opacity: 1;
      transition: opacity 500ms linear 700ms;
    }
    .links a {
      padding: 10px 10px 10px 0;
    }
    .links svg {
      fill: #777;
      transition: fill 200ms linear;
    }
    .links a:hover svg {
      fill : #333;
    }
    .source {
      font-size: 10px;
      margin-top: 12px;
      color: #bbb;
      text-transform: uppercase;
      opacity: 1;
      position: absolute;
      bottom: 25px;
      left: 30px;
      z-index: 10;
      transition: opacity 500ms 2500ms; 
    }
    .source span {
      margin-right: 10px;
    }
    .source a {
      margin: 0 5px;
      color: #777;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0);
      transition: color 200ms linear,
                  padding-bottom 400ms cubic-bezier(0.215, 0.610, 0.355, 1),
                  border-bottom 400ms cubic-bezier(0.215, 0.610, 0.355, 1);
    }
    .source a:hover {
      color: #333;
      padding-bottom: 2px;
      border-bottom: 1px solid rgba(51, 51, 51, 1);
    }

    .controls-container {
      padding-top: 0;
      top: 265px;
      opacity: 1;
      overflow: hidden;
      transform: translateY(0);
      transition: opacity 400ms linear 1600ms,
                  transform 800ms cubic-bezier(0.215, 0.610, 0.355, 1) 1600ms;
    }

    .controls-container button {
      flex-grow: 1;
      width: 33.333333333%;
      background: white;
      outline: none;
      border: 0;
      margin: 0;
      height: 100%;
      font-size: 10px;
      color: #bbb;
      cursor: pointer;
      text-transform: uppercase;
      line-height: 115%;
      transition: color 200ms linear;
    }

	.btn-group button {
		background-color: rgb(140, 146, 235); /* Green background */
		border: 1px solid #ffffff; /* Green border */
		color: white; /* White text */
		padding: 10px ; /* Some padding */
		cursor: pointer; /* Pointer/hand icon */
		float: left; /* Float the buttons side by side */
	}

	.btn-group button:hover {
		background-color: #3b4df1;
	}

	.btn-group button:active {
		background-color: #3b4df1;
	}

.container .checkmark:after {
    left: 9px;
    top: 5px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 3px 3px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    transform: rotate(45deg);
}

	</style>
	</head>
	<body>
		<div id="container" width="2000" height="2000"></div>
		<!-- <div id="distInfo"></div> -->


		<!--project information-->
		<div class="title card">
			<h1>Where to go in Time Square</h1>
			<div class="instructions">Drag & scroll to move around. Double-click to recenter the map.</div>
			<div class="links">
				<a href="https://github.com/rolyatmax/nyc-buildings" class="github-link">
				<svg width="22px" height="22px" viewBox="0 0 30 30" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M15,0.0576923077 C6.72580645,0.0576923077 0.00806451613,6.91483516 0.00806451613,15.3791209 C0.00806451613,22.1456044 4.30645161,27.8901099 10.2580645,29.9175824 C11.0080645,30.0576923 11.25,29.5879121 11.25,29.1840659 L11.25,26.3241758 C7.08064516,27.2554945 6.20967742,24.5192308 6.20967742,24.5192308 C5.53225806,22.7472527 4.5483871,22.2774725 4.5483871,22.2774725 C3.18548387,21.3296703 4.65322581,21.3461538 4.65322581,21.3461538 C6.16129032,21.4532967 6.9516129,22.9285714 6.9516129,22.9285714 C8.29032258,25.2692308 10.4596774,24.5934066 11.3145161,24.1978022 C11.4516129,23.2087912 11.8387097,22.532967 12.266129,22.1456044 C8.93548387,21.7582418 5.43548387,20.4478022 5.43548387,14.5714286 C5.43548387,12.8983516 6.02419355,11.5302198 6.98387097,10.4587912 C6.83064516,10.0714286 6.31451613,8.51373626 7.12903226,6.40384615 C7.12903226,6.40384615 8.38709677,5.99175824 11.25,7.97802198 C12.4435484,7.64010989 13.7258065,7.46703297 15,7.45879121 C16.2741935,7.46703297 17.5564516,7.63186813 18.7580645,7.97802198 C21.6209677,6 22.8790323,6.40384615 22.8790323,6.40384615 C23.6935484,8.51373626 23.1854839,10.0714286 23.0241935,10.4587912 C23.983871,11.5302198 24.5645161,12.8983516 24.5645161,14.5714286 C24.5645161,20.456044 21.0564516,21.75 17.7177419,22.1291209 C18.2580645,22.6071429 18.75,23.5384615 18.75,24.9642857 L18.75,29.1675824 C18.75,29.5714286 18.9919355,30.0494505 19.75,29.9010989 C25.7016129,27.8736264 29.9919355,22.1291209 29.9919355,15.3626374 C29.9919355,6.91483516 23.2741935,0.0576923077 15,0.0576923077 L15,0.0576923077 Z"></path></svg>
				</a>
				<a href="https://twitter.com/taylorbaldwin" class="twitter-link">
				<svg width='26px' height='22px' viewBox='0 0 36 30' version='1.1' xmlns='http://www.w3.org/2000/svg'><path d='M35.954717,3.55813953 C34.6301887,4.1627907 33.2150943,4.56976744 31.7207547,4.74418605 C33.2377358,3.80232558 34.4150943,2.3255814 34.9584906,0.558139535 C33.5320755,1.43023256 31.9584906,2.05813953 30.2830189,2.39534884 C28.9358491,0.930232558 27.0226415,0 24.9056604,0 C20.1509434,0 16.6528302,4.55813953 17.7283019,9.29069767 C11.6037736,8.97674419 6.16981132,5.96511628 2.53584906,1.38372093 C0.611320755,4.77906977 1.53962264,9.23255814 4.81132075,11.4883721 C3.6,11.4534884 2.46792453,11.1046512 1.47169811,10.5465116 C1.39245283,14.0581395 3.83773585,17.3372093 7.38113208,18.0581395 C6.33962264,18.3488372 5.20754717,18.4186047 4.05283019,18.1860465 C4.99245283,21.1976744 7.70943396,23.3837209 10.9358491,23.4418605 C7.83396226,25.9302326 3.93962264,27.0465116 0.0226415094,26.5813953 C3.28301887,28.7325581 7.15471698,29.9767442 11.3207547,29.9767442 C24.9962264,29.9767442 32.7283019,18.1046512 32.2641509,7.46511628 C33.7245283,6.40697674 34.9698113,5.08139535 35.954717,3.55813953 L35.954717,3.55813953 Z' /></svg>
				</a>
			</div>
		</div>

		<div style="padding-top: 20px" class="controls-container card">
			 <!-- <div class="btn-group">
				<button onclick="changeContent()">Restaurants</button>
				<button onclick="changeContent()">Hotels</button>
				<button onclick="changeContent()">Entertainment</button>
			</div>  -->
		
			<!--restaurant-->
			<div style="margin-bottom: 20px">
				<div style="width: 100%; float: left; padding-left: 12px">
					<input id="restID" type="checkbox" onclick="updatePlot()">Restaurants
				</div>
				<div style="padding-left: 12px">
					<div style="width:20%; float:left">
						<p>Price</p>
						<label><input id="restPriceVeryCheap" type="checkbox" onclick="updatePlot()">$</label><br>
						<label><input id="restPriceCheap" type="checkbox" onclick="updatePlot()">$$</label><br>
						<label><input id="restPriceMedium" type="checkbox" onclick="updatePlot()">$$$</label><br>
						<label><input id="restPriceExpensive" type="checkbox" onclick="updatePlot()">$$$$</label>
					</div>

					<div style="width:20%; float:left">
						<p>Ratings</p>
						<label><input type="checkbox">1</label><br>
						<label><input type="checkbox">2</label><br>
						<label><input type="checkbox">3</label><br>
						<label><input type="checkbox">4</label><br>
						<label><input type="checkbox">5</label>
					</div>

					<div style="width:30%; float: left">
						<p>Regions</p>
						<label><input id="restRegionMidtown" type="checkbox" onclick="updatePlot()">Midtown-Midtown South</label><br>
						<label><input id="restRegionClinton" type="checkbox" onclick="updatePlot()">Clinton</label><br>
						<label><input id="restRegionLincoln" type="checkbox" onclick="updatePlot()">Lincoln Square</label><br>
						<label><input id="restRegionSoho" type="checkbox" onclick="updatePlot()">Soho-TriBeCa-Civic Center-Little Italy</label>					
					</div>

					<div style="width:30%; float:left">
						<p>Tastes</p>
						<label><input id="restTasteMexican" type="checkbox" onclick="updatePlot()">Mexican</label><br>
						<label><input id="restTasteChinese" type="checkbox" onclick="updatePlot()">Chinese</label><br>
						<label><input id="restTasteItalian" type="checkbox" onclick="updatePlot()">Italian</label><br>
						<label><input id="restTasteFrench" type="checkbox" onclick="updatePlot()">French</label><br>
						<label><input id="restTasteAmerican" type="checkbox" onclick="updatePlot()">American</label><br>
						<label><input id="restTasteDiner" type="checkbox" onclick="updatePlot()">Diner</label><br>
						<label><input id="restTasteFastfood" type="checkbox" onclick="updatePlot()">Fast Food</label><br>
						<label><input id="restTasteDessert" type="checkbox" onclick="updatePlot()">Dessert</label><br>
						<label><input id="restTasteThai" type="checkbox" onclick="updatePlot()">Thai</label><br>
						<label><input id="restTasteSteakhouse" type="checkbox" onclick="updatePlot()">Steakhouse</label><br>
						<label><input id="restTasteBarbecue" type="checkbox" onclick="updatePlot()">Barbecue</label><br>
						<label><input id="restTastePanasian" type="checkbox" onclick="updatePlot()">Pan Asian</label><br>
						<label><input id="restTasteRussian" type="checkbox" onclick="updatePlot()">Russian</label><br>
						<label><input id="restTastePizza" type="checkbox" onclick="updatePlot()">Pizza</label><br>
						<label><input id="restTasteTurkish" type="checkbox" onclick="updatePlot()">Turkish</label><br>
						<label><input id="restTasteIdian" type="checkbox" onclick="updatePlot()">Indian</label><br>
						<label><input id="restTasteJapanese" type="checkbox" onclick="updatePlot()">Japanese</label><br>
						<label><input id="restTasteVietnamese" type="checkbox" onclick="updatePlot()">Vietnamese</label><br>
						<label><input id="restTasteSeafood" type="checkbox" onclick="updatePlot()">Seafood</label><br>
						<label><input id="restTasteCajun" type="checkbox" onclick="updatePlot()">Cajun</label><br>
						<label><input id="restTasteChilean" type="checkbox" onclick="updatePlot()">Chilean</label><br>
						<label><input id="restTasteBeverages" type="checkbox" onclick="updatePlot()">Beverages</label><br>
						<label><input id="restTasteScottish" type="checkbox" onclick="updatePlot()">Scottish</label><br>
						<label><input id="restTasteCatering" type="checkbox" onclick="updatePlot()">Catering</label><br>
						<label><input id="restTasteBelgian" type="checkbox" onclick="updatePlot()">Belgian</label><br>
						<label><input id="restTasteCuban" type="checkbox" onclick="updatePlot()">Cuban</label><br>
						<label><input id="restTasteBrazilian" type="checkbox" onclick="updatePlot()">Brazilian</label><br>
						<label><input id="restTasteOthers" type="checkbox" onclick="updatePlot()">Others</label><br>
						<label><input id="restTasteArgentinian" type="checkbox" onclick="updatePlot()">Argentinian</label><br>
						<label><input id="restTasteSpanish" type="checkbox" onclick="updatePlot()">Spanish</label>	
						<label><input id="restTasteOrganic" type="checkbox" onclick="updatePlot()">Organic</label>
						<label><input id="restTasteNonbeverages" type="checkbox" onclick="updatePlot()">Non beverages</label>
						
					</div>
				</div>
			</div>

			<!--hotel-->
			<div style="margin-bottom: 20px">
				<div style="width: 100%; float: left; padding-left: 12px">
					<input id="hotelID" type="checkbox" onclick="updatePlot()">Hotels
				</div>
				<div style="padding-left: 12px">
					<div style="width:33%; float:left">
						<p>Price</p>
						<label><input id="hotelPriceVeryCheap" type="checkbox" onclick="updatePlot()">$</label><br>						
						<label><input id="hotelPriceCheap" type="checkbox" onclick="updatePlot()">$$</label><br>
						<label><input id="hotelPriceMedium" type="checkbox" onclick="updatePlot()">$$$</label><br>
						<label><input id="hotelPriceExpensive" type="checkbox" onclick="updatePlot()">$$$$</label>
					</div>

					<div style="width:33%; float:left">
						<p>Ratings</p>
						<label><input type="checkbox">1</label><br>
						<label><input type="checkbox">2</label><br>
						<label><input type="checkbox">3</label><br>
						<label><input type="checkbox">4</label><br>
						<label><input type="checkbox">5</label>
					</div>

					<div style="width:33%; float:left">
						<p>Regions</p>
						<label><input id="hotelRegionMidtown" type="checkbox" onclick="updatePlot()">Midtown-Midtown South</label><br>
						<label><input id="hotelRegionClinton" type="checkbox" onclick="updatePlot()">Clinton</label>
					</div>
				</div>
			</div>

			<!--entertainment-->
			<div style="margin-bottom: 20px">
				<div style="width: 100%; float: left; padding-left: 12px">
					<input id="enterID" type="checkbox" onclick="updatePlot()">Entertainment
				</div>
				<div style="padding-left: 12px">
					<div style="width:20%; float:left">
						<p>Price</p>
						<label><input id="enterPriceVeryCheap" type="checkbox" onclick="updatePlot()">$</label><br>						
						<label><input id="enterPriceCheap" type="checkbox" onclick="updatePlot()">$$</label><br>
						<label><input id="enterPriceMedium" type="checkbox" onclick="updatePlot()">$$$</label><br>
						<label><input id="enterPriceExpensive" type="checkbox" onclick="updatePlot()">$$$$</label>
					</div>

					<div style="width:20%; float:left">
						<p>Ratings</p>
						<label><input type="checkbox">1</label><br>
						<label><input type="checkbox">2</label><br>
						<label><input type="checkbox">3</label><br>
						<label><input type="checkbox">4</label><br>
						<label><input type="checkbox">5</label>
					</div>

					<div style="width:30%; float:left">
						<p>Regions</p>
						<label><input id="enterRegionMidtown" type="checkbox" onclick="updatePlot()">Midtown-Midtown South</label><br>
						<label><input id="enterRegionClinton" type="checkbox" onclick="updatePlot()">Clinton</label>
						<label><input id="enterRegionOther" type="checkbox" onclick="updatePlot()">Others</label>
					</div>

					<div style="width:30%; float:left">
						<p>Venue Types</p>
						<label><input id="enterVenueTheater" type="checkbox" onclick="updatePlot()">Theater</label><br>
						<label><input id="enterVenueComedy" type="checkbox" onclick="updatePlot()">Comedy Club</label><br>
						<label><input id="enterVenueNightclub" type="checkbox" onclick="updatePlot()">Nightclub</label><br>
						<label><input id="enterVenueAttraction" type="checkbox" onclick="updatePlot()">Attractions/Amusement</label><br>
						<label><input id="enterVenueMovie" type="checkbox" onclick="updatePlot()">Movies</label><br>
						<label><input id="enterVenueMuseum" type="checkbox" onclick="updatePlot()">Museums/Galleries</label><br>
						<label><input id="enterVenueLivemusic" type="checkbox" onclick="updatePlot()">Live Music</label><br>
						<label><input id="enterVenueLecturehall" type="checkbox" onclick="updatePlot()">Lecture Hall</label><br>
					</div>

				</div>
			</div>
		</div>
		


		<script src="three.js-master/build/three.js"></script>
		<script src="https://d3js.org/d3.v4.min.js"></script>

		<script src="js/DragControls.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/TransformControls.js"></script>
		<script src="js/three.interaction.js"></script>

		<script src="js/dat.gui.min.js"></script>
		<script src="js/utils.js"></script>
		<script src="js/textures.js"></script>



		<script src="js/filterRestaurants.js"></script>
		<script src="js/filterHotels.js"></script>
		<script src="js/filterEntertainment.js"></script>
		<script>

			var hotelData;
			var restaurantData;
			var entertainmentData;
			var buildingObjects = [];
			var positions = [];
			var objectCount = 0;
			var projection = d3.geoMercator()

			//to alignment the coordinate plane
			var xOffset = -1000;
			var yOffset = -7000;
			var scaleFactor = 10000;
			var angle = 33;
			var minX, minY, maxX, maxY;

			var hiding;

			//control
			var container, stats;
			var scene = new THREE.Scene();
			var camera, renderer, raycaster;
			var mouse = new THREE.Vector2(), INTERSECTED;
			var point = new THREE.Vector3();
			var geometry = new THREE.BoxBufferGeometry( 50, 100, 50 );
			var transformControl;
			var ARC_SEGMENTS = 200;
			var splines = {};
			var params = {
				restaurant: {
					include: true,
					price: 100,
					category: {
						chinese: true,
						korean: true,
						american: true,
						indian: true,
						italian: true
					}
				},
				hotel: {
					include: true,
					price: 100,
					category: {
						holiday: true,
						business: true
					}
				},
				entertainment: {
					include: true,
					price: 100,
					category: {
						movie: true,
						game: true,
						shopping: true
					}
				}
			};


			var spritey;
			var canvas1, context1, texture1;



			// var distInfo = d3.select('#distInfo').append('svg')
			// .style('background', 'white')
			// .attr("id", "bar")
			// .attr('width', "600")
			// .attr('height', "165");
			
			// distInfo.append("text")
			// .attr("id","distInit")
			// .attr("x", 50)
			// .attr("y", 100-60)
			// .attr("font-size", "30px")
			// .attr("font-weight", "900")
			// .style("fill", "#1C1B1B")
			// .text("All NYC Public Schools");
			


			//load csv file
			d3.queue()
			.defer(d3.csv, "data/hotels.csv")
			.defer(d3.csv, "data/restaurants.csv")
			.defer(d3.csv, "data/entertainment.csv")
			.await(function(error, data1, data2, data3) {
				if (error) {
					console.error('Oh dear, something went wrong: ' + error);
				}
				else {
					hotelData = data1;
					restaurantData = data2;
					entertainmentData = data3;
					console.log(hotelData);
					console.log(restaurantData);

					assignCoordinate(hotelData);
					assignCoordinate(restaurantData);
					assignCoordinate(entertainmentData);

					maxX = d3.max(hotelData.map(function(d){return d.coordinate[0];}));
					minX = d3.min(hotelData.map(function(d){return d.coordinate[0];}));
					maxY = d3.max(hotelData.map(function(d){return d.coordinate[1];}));
					minY = d3.min(hotelData.map(function(d){return d.coordinate[1];}));

					scaleData(restaurantData);
					scaleData(hotelData);
					scaleData(entertainmentData);
				}

				init();
				plot();
				animate();
			});

			function init() {
				container = document.getElementById( 'container' );
				scene.background = new THREE.Color( 0xf0f0f0 );
				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 100000 );
				camera.position.set( 0, 250, 1000 );
				scene.add( camera );
				scene.add( new THREE.AmbientLight( 0xf0f0f0 ) );

				// add raycaster
				raycaster = new THREE.Raycaster();


				addLightShadow();
				// createGUI();

				var planeGeometry = new THREE.PlaneBufferGeometry( 15000, 7000 );
				planeGeometry.rotateX( - Math.PI / 2 );
				var planeMaterial = new THREE.ShadowMaterial( { opacity: 0.2 } );

				//add plane
				var plane = new THREE.Mesh( planeGeometry, planeMaterial );
				plane.position.y = -200;
				plane.receiveShadow = true;
				scene.add( plane );

				//grid helper
				// var helper = new THREE.GridHelper( 15000, 100 );
				// helper.position.y = - 199;
				// helper.material.opacity = 0.25;
				// helper.material.transparent = true;
				// scene.add( helper );

				//render
				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.shadowMap.enabled = true;
				container.appendChild( renderer.domElement );

				// Controls
				var controls = new THREE.OrbitControls( camera, renderer.domElement );

				// interaction
				var interaction = new THREE.Interaction(renderer, scene, camera);

				// sprite
				var spritex;				

			}


			function animate() {
				requestAnimationFrame( animate );
				render();
			}


			function render() {

				renderer.render( scene, camera );				
			}


			function assignCoordinate(data) {
				for (var i = 0; i < data.length; i++) {
					var aa = [data[i].Latitude, data[i].Longitude];
					data[i].coordinate = projection(aa);
				}
			}


			function scaleData(data) {
				for (var i = 0; i < data.length; i++) {
					data[i].coordinate[0] = (data[i].coordinate[0] - minX) / (maxX - minX) * scaleFactor;
					data[i].coordinate[1] = (data[i].coordinate[1] - minY) / (maxY - minY) * scaleFactor;					
					var x = data[i].coordinate[0];
					var y = data[i].coordinate[1];
					var rad = angle * Math.PI/180;
					data[i].coordinate[0] = x * Math.cos(rad) - y * Math.sin(rad) + xOffset;
					data[i].coordinate[1] = y * Math.cos(rad) + x * Math.sin(rad) + yOffset;					
				}
			}


			function addLightShadow() {
				//light and shadow
				var light = new THREE.SpotLight( 0xffffff, 1.5 );
				light.position.set( 0, 1500, 200 );
				light.castShadow = true;
				light.shadow = new THREE.LightShadow( new THREE.PerspectiveCamera( 70, 1, 200, 2000 ) );
				light.shadow.bias = -0.000222;
				light.shadow.mapSize.width = 1024;
				light.shadow.mapSize.height = 1024;
				scene.add( light );
				spotlight = light;
			}


			function addSplineObject( position, name) {
				var material = new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff } );
				var object = new THREE.Mesh( geometry, material );

				// var object = createHospital();
				// object.position.y = -200;
				object.position.copy( position );

				object.castShadow = true;
				object.receiveShadow = true;

				object.on('mousedown', function(ev) {
					mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
					mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
					var vector = new THREE.Vector3(mouse.x, mouse.y, 0.5);
					vector.unproject( camera );
					var dir = vector.sub( camera.position ).normalize();
					var distance = - camera.position.z / dir.z;
					var pos = camera.position.clone().add( dir.multiplyScalar( distance ) );
					spritex = makeTextSprite( name, { fontsize: 24, borderColor: {r:0, g:0, b:255, a:1.0}} );
					console.log(spritex)
					spritex.position.copy(pos);
					scene.add( spritex );
				});
				object.on('mouseup', function(ev) {
					scene.remove( spritex );
				});

				scene.add( object );
				buildingObjects.push( object );
				return object;
			}


			function plot() {
				for (var i = 0; i < hotelData.length; i++) {
					var object = addSplineObject(new THREE.Vector3(hotelData[i].coordinate[0], -150, hotelData[i].coordinate[1]), hotelData[i]["Company Name"]);
					objectCount++;
					positions.push(object.position);
				}
				for (var i = 0; i < restaurantData.length; i++) {
					var object = addSplineObject(new THREE.Vector3(restaurantData[i].coordinate[0], -150, restaurantData[i].coordinate[1]), restaurantData[i]["Company Name"]);
					objectCount++;
					positions.push(object.position);
				}
				for (var i = 0; i < entertainmentData.length; i++) {
					var object = addSplineObject(new THREE.Vector3(entertainmentData[i].coordinate[0], -150, entertainmentData[i].coordinate[1]), entertainmentData[i]["Company Name"]);			
					objectCount++;
					positions.push(object.position);
				}					
			}

			function updatePlot() {
				removeAllPoints();
				updateRestaurant();
				updateHotel();
				updateEntertainment();				
			}


			function removeAllPoints() {
				if ( objectCount <= 0 ) {
					return;
				}
				for (var i = 0; i < objectCount; i++) {
					positions.pop();
					scene.remove( buildingObjects.pop() );
				}
				objectCount = 0;
			}


			function makeTextSprite( message, parameters ){
			
				if ( parameters === undefined ) parameters = {};
				
				var fontface = parameters.hasOwnProperty("fontface") ? 
					parameters["fontface"] : "Arial";
				
				var fontsize = parameters.hasOwnProperty("fontsize") ? 
					parameters["fontsize"] : 18;
				
				var borderThickness = parameters.hasOwnProperty("borderThickness") ? 
					parameters["borderThickness"] : 4;
				
				var borderColor = parameters.hasOwnProperty("borderColor") ?
					parameters["borderColor"] : { r:0, g:0, b:0, a:1.0 };
				
				var backgroundColor = parameters.hasOwnProperty("backgroundColor") ?
					parameters["backgroundColor"] : { r:255, g:255, b:255, a:1.0 };
				// var spriteAlignment = THREE.SpriteAlignment.topLeft;
					
				var canvas = document.createElement('canvas');
				var context = canvas.getContext('2d');
				context.font = "Bold " + fontsize + "px " + fontface;
				
				// get size data (height depends only on font size)
				var metrics = context.measureText( message );
				var textWidth = metrics.width;
				
				// background color
				context.fillStyle   = "rgba(" + backgroundColor.r + "," + backgroundColor.g + ","
											+ backgroundColor.b + "," + backgroundColor.a + ")";
				// border color
				context.strokeStyle = "rgba(" + borderColor.r + "," + borderColor.g + ","
											+ borderColor.b + "," + borderColor.a + ")";
				context.lineWidth = borderThickness;
				roundRect(context, borderThickness/2, borderThickness/2, textWidth + borderThickness, fontsize * 1.4 + borderThickness, 6);
				// 1.4 is extra height factor for text below baseline: g,j,p,q.
				
				// text color
				context.fillStyle = "rgba(0, 0, 0, 1.0)";
				context.fillText( message, borderThickness, fontsize + borderThickness);
				
				// canvas contents will be used for a texture
				var texture = new THREE.Texture(canvas) 
				texture.needsUpdate = true;
				var spriteMaterial = new THREE.SpriteMaterial( 
					{ map: texture, useScreenCoordinates: false } );

				var sprite = new THREE.Sprite( spriteMaterial );
				sprite.scale.set(100,50,1.0);
				return sprite;	
			}
			function roundRect(ctx, x, y, w, h, r) 
			{
				ctx.beginPath();
				ctx.moveTo(x+r, y);
				ctx.lineTo(x+w-r, y);
				ctx.quadraticCurveTo(x+w, y, x+w, y+r);
				ctx.lineTo(x+w, y+h-r);
				ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
				ctx.lineTo(x+r, y+h);
				ctx.quadraticCurveTo(x, y+h, x, y+h-r);
				ctx.lineTo(x, y+r);
				ctx.quadraticCurveTo(x, y, x+r, y);
				ctx.closePath();
				ctx.fill();
				ctx.stroke();   
			}





			// addHospital();

			function addHospital() {
				var hospital = createHospital()
				hospital.position.z = -20
				hospital.position.y = -200

				scene.add(hospital)
			}

			function createHospital() {
				var hospital = new THREE.Object3D()

				var baseGeometry = new THREE.BoxBufferGeometry(180, 3, 140)
				var base = utils.makeMesh('lambert', baseGeometry, 0xffffff)
				base.position.y = 1
				hospital.add(base)

				var frontMainCoords = [
				[-80, -30],
				[-80, 20],
				[50, 20],
				[50, 0],
				[20, -30],
				[-80, -30]
				]
				var frontMainShape = utils.makeShape(frontMainCoords)
				var frontMainGeometry = utils.makeExtrudeGeometry(frontMainShape, 100)
				var frontMainMaterial = new THREE.MeshPhongMaterial({ map: textures.window() })
				frontMainMaterial.map.repeat.set(0.1, 0.08)
				var frontMain = new THREE.Mesh(frontMainGeometry, frontMainMaterial)
				frontMain.castShadow = true
				frontMain.receiveShadow = true
				hospital.add(frontMain)

				var frontTopShape = frontMainShape
				var frontTopGeometry = utils.makeExtrudeGeometry(frontTopShape, 5)
				var frontTop = utils.makeMesh('lambert', frontTopGeometry, 0xb1a7af)
				frontTop.position.y = 100
				hospital.add(frontTop)

				var frontRoofShelfGeometry = new THREE.Geometry()
				var frontRoofShelfCubeGeometry = new THREE.BoxGeometry(2, 2, 40)
				// for z-axis
				for (var i = 0; i < 12; i++) {
				var geometry = frontRoofShelfCubeGeometry.clone()
				geometry.translate(i * 5, 0, 0)
				frontRoofShelfGeometry.merge(geometry)
				}
				// for x-axis
				for (var i = 0; i < 2; i++) {
				var geometry = frontRoofShelfCubeGeometry.clone()
				geometry.rotateY(0.5 * Math.PI)
				geometry.scale(1.6, 1, 1)
				geometry.translate(27, 0, -15 + i * 30)
				frontRoofShelfGeometry.merge(geometry)
				}
				// for y-axis
				var frontRoofShelfCubeYPosition = [
				[0, 0],
				[1, 0],
				[0, 1],
				[1, 1]
				]
				for (var i = 0; i < frontRoofShelfCubeYPosition.length; i++) {
				var p = frontRoofShelfCubeYPosition[i]
				var geometry = frontRoofShelfCubeGeometry.clone()
				geometry.scale(1, 1, 0.4)
				geometry.rotateX(0.5 * Math.PI)
				geometry.translate(p[0] * 55, 0, -15 + p[1] * 30)
				frontRoofShelfGeometry.merge(geometry)
				}
				frontRoofShelfGeometry = new THREE.BufferGeometry().fromGeometry(frontRoofShelfGeometry)
				var frontRoofShelf = utils.makeMesh('phong', frontRoofShelfGeometry, 0xffffff)
				frontRoofShelf.position.set(-70, 115, 5)
				hospital.add(frontRoofShelf)

				var frontPlatGeometry = new THREE.BoxBufferGeometry(150, 3, 90)
				var fronPlat = utils.makeMesh('lambert', frontPlatGeometry, 0x0792a5)
				fronPlat.position.set(-3, 18, 25)
				hospital.add(fronPlat)

				var frontPlatVerticalGeometry = new THREE.BoxBufferGeometry(150, 15, 3)
				var frontPlatVertical = utils.makeMesh('phong', frontPlatVerticalGeometry, 0x0792a5)
				frontPlatVertical.receiveShadow = false
				frontPlatVertical.position.set(-3, 24, 68.5)
				hospital.add(frontPlatVertical)

				var frontPlatVerticalWhiteGeometry = new THREE.BoxBufferGeometry(150, 3, 3)
				var frontPlatVerticalWhite = utils.makeMesh('phong', frontPlatVerticalWhiteGeometry, 0xffffff)
				frontPlatVerticalWhite.position.set(-3, 33, 68.5)
				hospital.add(frontPlatVerticalWhite)

				var frontPlatPillarGeometry = new THREE.CylinderGeometry(2, 2, 15, 32)
				var frontPlatPillar = utils.makeMesh('lambert', frontPlatPillarGeometry, 0xffffff)
				frontPlatPillar.position.set(-60, 10, 55)
				hospital.add(frontPlatPillar)

				var frontPlatPillar2 = frontPlatPillar.clone()
				frontPlatPillar2.position.set(55, 10, 55)
				hospital.add(frontPlatPillar2)

				var frontBorderVerticles = new THREE.Object3D()
				var frontBorderVerticleGeometry = new THREE.BoxBufferGeometry(4, 106, 4)
				var frontBorderVerticleMesh = utils.makeMesh('phong', frontBorderVerticleGeometry, 0xffffff)
				var frontBorderVerticle1 = frontBorderVerticleMesh.clone()
				frontBorderVerticle1.position.set(-80, 52, 30)
				frontBorderVerticles.add(frontBorderVerticle1)
				var frontBorderVerticle2 = frontBorderVerticleMesh.clone()
				frontBorderVerticle2.position.set(-80, 52, -20)
				frontBorderVerticles.add(frontBorderVerticle2)
				var frontBorderVerticle3 = frontBorderVerticleMesh.clone()
				frontBorderVerticle3.position.set(50, 52, -18)
				frontBorderVerticles.add(frontBorderVerticle3)
				hospital.add(frontBorderVerticles)

				var frontRoofCoords = [
				[-82, -32],
				[20, -32],
				[52, 0],
				[52, 22],
				[-82, 22],
				[-82, -32]
				]
				var frontRoofHolePath = [
				[-78, -28],
				[20, -28],
				[48, 0],
				[48, 18],
				[-78, 18],
				[-78, -28]
				]
				var frontRoofShape = utils.makeShape(frontRoofCoords, frontRoofHolePath)
				var frontRoofGeometry = utils.makeExtrudeGeometry(frontRoofShape, 8)
				var frontRoof = utils.makeMesh('phong', frontRoofGeometry, 0xffffff)
				frontRoof.position.y = 100
				hospital.add(frontRoof)

				var backMainCoords = [
				[-80, 20],
				[-80, 60],
				[80, 60],
				[80, 20],
				[-80, 20]
				]
				var backMainHolePath = [
				[-78, 22],
				[78, 22],
				[78, 58],
				[-78, 58],
				[-78, 22]
				]
				var backMainShape = utils.makeShape(backMainCoords, backMainHolePath)

				var backMainGeometry = utils.makeExtrudeGeometry(backMainShape, 90)
				var backMain = utils.makeMesh('lambert', backMainGeometry, 0xf2e21b)
				hospital.add(backMain)

				var backMiddleCoords = [
				[0, 0],
				[36, 0],
				[36, 70],
				[0, 70],
				[0, 0]
				]
				var backMiddleHolePath = [
				[2, 2],
				[34, 2],
				[34, 68],
				[2, 68],
				[2, 2]
				]
				var backMiddleShape = utils.makeShape(backMiddleCoords, backMiddleHolePath)
				var backMiddkeGeometry = utils.makeExtrudeGeometry(backMiddleShape, 165)
				var backMiddle = utils.makeMesh('lambert', backMiddkeGeometry, 0xffffff)

				backMiddle.rotation.x = -0.5 * Math.PI
				backMiddle.rotation.z = -0.5 * Math.PI
				backMiddle.position.y = 86
				backMiddle.position.z = -58
				backMiddle.position.x = -78
				hospital.add(backMiddle)

				var backMiddleWindowGeometry = new THREE.PlaneGeometry(32, 66, 1, 1)
				var backMiddleWindowMaterial = new THREE.MeshPhongMaterial({ map: textures.window() })
				backMiddleWindowMaterial.map.repeat.set(2, 6)

				var backMiddleWindow = new THREE.Mesh(backMiddleWindowGeometry, backMiddleWindowMaterial)
				backMiddleWindow.position.set(83, 51, -40)
				backMiddleWindow.rotation.y = 0.5 * Math.PI
				hospital.add(backMiddleWindow)

				var windowBackOrigin = createWindow()
				windowBackOrigin.scale.set(0.6, 0.6, 1)
				windowBackOrigin.rotation.y = Math.PI
				windowBackOrigin.position.set(65, 75, -61)
				for (var i = 0; i < 7; i++) {
				for (var j = 0; j < 4; j++) {
					var windowObj = windowBackOrigin.clone()
					windowObj.position.x -= i * 22
					windowObj.position.y -= j * 20
					hospital.add(windowObj)
				}
				}

				return hospital	
			}

			function createWindow() {
				var windowObj = new THREE.Object3D()
				var glassGeometry = new THREE.PlaneGeometry(20, 20)
				var glass = utils.makeMesh('phong', glassGeometry, 0x6a5e74)
				windowObj.add(glass)

				var windowBorderGeometry = new THREE.BoxBufferGeometry(22, 2, 2)
				var windowBorder = utils.makeMesh('phong', windowBorderGeometry, 0xffffff)

				var windowBorderTop = windowBorder.clone()
				windowBorderTop.position.y = 10
				windowObj.add(windowBorderTop)

				var windowBorderBottom = windowBorder.clone()
				windowBorderBottom.position.y = -10
				windowObj.add(windowBorderBottom)

				var windowBorderLeft = windowBorder.clone()
				windowBorderLeft.rotation.z = 0.5 * Math.PI
				windowBorderLeft.position.x = -10
				windowObj.add(windowBorderLeft)

				var windowBorderRight = windowBorderLeft.clone()
				windowBorderRight.position.x = 10
				windowObj.add(windowBorderRight)

				return windowObj
			}



		</script>
	</body>
</html>