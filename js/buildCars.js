var cars = [];
var cars2 = [];
// 生成汽车
function buildStaticCars () {
    var carsPosition = [
        [-1700, -1200, 1.5], 
        [-1700, -1400, 1.5], 
        [-1700, -1600, 1.5], 
        [-1700, -1800, 1.5],

        [-1800, -2000, 1.5],
        [-1800, -2200, 1.5],
        [-1800, -2400, 1.5],
        [-1800, -2600, 1.5],

        [-500, -1200, 1.5], 
        [-500, -1400, 1.5], 
        [-500, -1600, 1.5], 
        [-500, -1800, 1.5],

        [-400, -2000, 1.5],
        [-400, -2200, 1.5],
        [-400, -2400, 1.5],
        [-400, -2600, 1.5],

        [500, -1200, 1.5], 
        [500, -1400, 1.5], 
        [500, -1600, 1.5], 
        [500, -1800, 1.5],

        [400, -2000, 1.5],
        [400, -2200, 1.5],
        [400, -2400, 1.5],
        [400, -2600, 1.5],

        [1700, -1200, 1.5], 
        [1700, -1400, 1.5], 
        [1700, -1600, 1.5], 
        [1700, -1800, 1.5],

        [1600, -2000, 1.5],
        [1600, -2200, 1.5],
        [1600, -2400, 1.5],
        [1600, -2600, 1.5],

        [2500, -1200, 1.5], 
        [2500, -1400, 1.5], 
        [2500, -1600, 1.5], 
        [2500, -1800, 1.5],

        [2600, -2000, 1.5],
        [2600, -2200, 1.5],
        [2600, -2400, 1.5],
        [2600, -2600, 1.5],

        [3400, -1200, 1.5], 
        [3400, -1400, 1.5], 
        [3400, -1600, 1.5], 
        [3400, -1800, 1.5],

        [3500, -2000, 1.5],
        [3500, -2200, 1.5],
        [3500, -2400, 1.5],
        [3500, -2600, 1.5],

        //bottom
        [800, 800, 1.5], 
        [800, 1000, 1.5], 
        [800, 1200, 1.5], 
        [800, 1400, 1.5],

        [700, 1600, 1.5],
        [700, 1800, 1.5],
        [700, 2000, 1.5],
        [700, 2200, 1.5],

        [1100, 800, 1.5], 
        [1100, 1000, 1.5], 
        [1100, 1200, 1.5], 
        [1100, 1400, 1.5],

        [1900, 1600, 1.5],
        [1900, 1800, 1.5],
        [1900, 2000, 1.5],
        [1900, 2200, 1.5],

        [1700, 800, 1.5], 
        [1700, 1000, 1.5], 
        [1700, 1200, 1.5], 
        [1700, 1400, 1.5],

        [700, 1600, 1.5],
        [700, 1800, 1.5],
        [700, 2000, 1.5],
        [700, 2200, 1.5],

        [-200, 800, 1.5], 
        [-200, 1000, 1.5], 
        [-200, 1200, 1.5], 
        [-200, 1400, 1.5],

        [-100, 1600, 1.5],
        [-100, 1800, 1.5],
        [-100, 2000, 1.5],
        [-100, 2200, 1.5],

        [-1100, 800, 1.5], 
        [-1100, 1000, 1.5], 
        [-1100, 1200, 1.5], 
        [-1100, 1400, 1.5],

        [-1000, 1600, 1.5],
        [-1000, 1800, 1.5],
        [-1000, 2000, 1.5],
        [-1000, 2200, 1.5],

        [-2200, 800, 1.5], 
        [-2200, 1000, 1.5], 
        [-2200, 1200, 1.5], 
        [-2200, 1400, 1.5],

        [-2300, 1600, 1.5],
        [-2300, 1800, 1.5],
        [-2300, 2000, 1.5],
        [-2300, 2200, 1.5],


        [-3100, 800, 1.5], 
        [-3100, 1000, 1.5], 
        [-3100, 1200, 1.5], 
        [-3100, 1400, 1.5],

        [-3200, 1600, 1.5],
        [-3200, 1800, 1.5],
        [-3200, 2000, 1.5],
        [-3200, 2200, 1.5],
        
    ]
    carsPosition.forEach(function (elem) {	
        var car = new Car()
        var x = elem[0],
            z = elem[1],
            r = elem[2]
        car.setPosition(x, -200, z)
        car.mesh.rotation.y = r * Math.PI
        scene.add(car.mesh)
    })
}

function buildMovingCars() {
    var y1 = -950;
    var y2 = 2600;
    var y3 = 2500;
    var y4 = -900;
    var carsPosition = []

    for (i = 0; i < 100; i++) {
        carsPosition.push([-500 - i * 500, y1, 0]);
        carsPosition.push([-400 - i * 500, y2, 0]);
        carsPosition.push([-300 - i * 500, y3, 0]);
        carsPosition.push([-200 - i * 500, y4, 0]);
    }
    carsPosition.forEach(function(elem) {
        var car = new Car()
        var x = elem[0],
        z = elem[1],
        r = elem[2]
        car.setPosition(x, -200, z)
        car.mesh.rotation.y = r * Math.PI
        cars.push(car)
        scene.add(car.mesh)
    })
}


function carMoving(car) {
    var angle = car.mesh.rotation.y
    var x = car.mesh.position.x,
    z = car.mesh.position.z

    if (x < 3000) {
        car.forward();
    }
}

function loop() {
    // stats.update()
    cars.forEach(function(car) {
        carMoving(car)
    })
    renderer.render(scene, camera)
    requestAnimationFrame(loop)
}


var now,delta,then = Date.now();
var interval = 1000/30;
